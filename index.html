<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Robotic Arm Controller</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #0b1120;
    color: #e2e8f0;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  h1 {
    color: #60a5fa;
    margin-top: 20px;
  }
  .section {
    background: rgba(30,41,59,0.8);
    margin: 15px auto;
    padding: 15px;
    width: 90%;
    max-width: 400px;
    border-radius: 10px;
  }
  input[type=range] {
    width: 100%;
  }
  button {
    background: linear-gradient(135deg,#3b82f6,#2563eb);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    font-size: 15px;
    margin: 5px;
    cursor: pointer;
  }
  button:hover { filter: brightness(1.1); }
  #connectBtn.connected {
    background: linear-gradient(135deg,#10b981,#059669);
  }
</style>
</head>
<body>
<h1>ðŸ¤– Robotic Arm Controller</h1>
<button id="connectBtn">ðŸ”Œ Connect Bluetooth</button>
<p id="status">Status: Disconnected</p>

<div class="section">
  <h3>ðŸŽ¯ Presets</h3>
  <button data-cmd="HOME">Home</button>
  <button data-cmd="GRAB">Grab</button>
  <button data-cmd="LIFT">Lift</button>
  <button data-cmd="RELEASE">Release</button>
  <button data-cmd="PARK">Park</button>
</div>

<div class="section">
  <h3>ðŸ§­ Base</h3>
  <input type="range" id="base" min="0" max="180" value="90">
  <p>Angle: <span id="baseVal">90</span>Â°</p>
</div>

<div class="section">
  <h3>ðŸ’ª Shoulder</h3>
  <input type="range" id="shoulder" min="0" max="180" value="90">
  <p>Angle: <span id="shoulderVal">90</span>Â°</p>
</div>

<div class="section">
  <h3>ðŸ¦¾ Elbow</h3>
  <input type="range" id="elbow" min="0" max="180" value="90">
  <p>Angle: <span id="elbowVal">90</span>Â°</p>
</div>

<div class="section">
  <h3>âœ‹ Gripper</h3>
  <input type="range" id="gripper" min="0" max="180" value="90">
  <p>Angle: <span id="gripperVal">90</span>Â°</p>
  <button data-cmd="O">Open</button>
  <button data-cmd="C">Close</button>
</div>

<script>
let bleDevice, bleCharacteristic;

const SERVICE_UUID = '0000ffe0-0000-1000-8000-00805f9b34fb';
const CHARACTERISTIC_UUID = '0000ffe1-0000-1000-8000-00805f9b34fb';

const connectBtn = document.getElementById('connectBtn');
const statusP = document.getElementById('status');

connectBtn.addEventListener('click', async () => {
  try {
    if (!navigator.bluetooth) {
      alert('Web Bluetooth not supported. Use Chrome or Edge.');
      return;
    }
    statusP.textContent = 'Status: Scanning...';
    bleDevice = await navigator.bluetooth.requestDevice({
      filters: [{ name: 'RoboticArm_ESP32' }],
      optionalServices: [SERVICE_UUID]
    });
    const server = await bleDevice.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);
    bleCharacteristic = await service.getCharacteristic(CHARACTERISTIC_UUID);
    connectBtn.classList.add('connected');
    statusP.textContent = 'Status: Connected âœ…';
  } catch (e) {
    console.error(e);
    statusP.textContent = 'Status: Connection failed âŒ';
  }
});

async function sendCommand(cmd) {
  if (!bleCharacteristic) return alert('Not connected!');
  const enc = new TextEncoder();
  await bleCharacteristic.writeValueWithoutResponse(enc.encode(cmd + '\n'));
  console.log('Sent:', cmd);
}

// Slider handlers
function setupSlider(id, prefix) {
  const el = document.getElementById(id);
  const val = document.getElementById(id + 'Val');
  el.addEventListener('input', () => {
    val.textContent = el.value;
    sendCommand(prefix + el.value);
  });
}
setupSlider('base','B');
setupSlider('shoulder','SH');
setupSlider('elbow','EL');
setupSlider('gripper','G');

// Preset buttons
document.querySelectorAll('button[data-cmd]').forEach(btn=>{
  btn.addEventListener('click',()=>sendCommand(btn.dataset.cmd));
});
</script>
</body>
</html>
